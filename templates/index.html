<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Social Media Downloader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .supported-platforms {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .platform-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .download-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 600;
        }

        .url-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .url-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .bulk-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
        }

        .bulk-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .downloads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .download-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .download-item:hover {
            transform: translateY(-4px);
        }

        .download-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .download-item p {
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .download-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .feature-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .feature-item p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #e9ecef;
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .supported-platforms {
                justify-content: center;
            }

            .downloads-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Universal Social Media Downloader</h1>
            <p>Download content from any social media platform with just a link!</p>
        </div>

        <div class="supported-platforms">
            <div class="platform-badge">üì∫ YouTube</div>
            <div class="platform-badge">üì∏ Instagram</div>
            <div class="platform-badge">üéµ TikTok</div>
            <div class="platform-badge">üê¶ Twitter/X</div>
            <div class="platform-badge">üìò Facebook</div>
            <div class="platform-badge">ü§ñ Reddit</div>
            <div class="platform-badge">üéÆ Twitch</div>
            <div class="platform-badge">üíº LinkedIn</div>
        </div>

        <div class="download-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('single')">Single Download</button>
                <button class="tab" onclick="switchTab('bulk')">Bulk Download</button>
                <button class="tab" onclick="switchTab('downloads')">My Downloads</button>
            </div>

            <!-- Single Download Tab -->
            <div id="single-tab" class="tab-content active">
                <div class="section-title">
                    <span>üéØ</span>
                    <span>Single Download</span>
                </div>
                
                <div class="input-group">
                    <label for="single-url">Enter URL:</label>
                    <input type="url" id="single-url" class="url-input" placeholder="Paste any social media URL here (YouTube, Instagram, TikTok, etc.)" />
                </div>
                
                <button class="btn" onclick="downloadSingle()">
                    <span id="single-spinner" class="loading-spinner" style="display: none;"></span>
                    <span id="single-text">üöÄ Download Now</span>
                </button>
                
                <div id="single-status"></div>
            </div>

            <!-- Bulk Download Tab -->
            <div id="bulk-tab" class="tab-content">
                <div class="section-title">
                    <span>üì¶</span>
                    <span>Bulk Download</span>
                </div>
                
                <div class="input-group">
                    <label for="bulk-urls">Enter multiple URLs (one per line):</label>
                    <textarea id="bulk-urls" class="bulk-textarea" placeholder="https://www.instagram.com/p/example1/&#10;https://www.youtube.com/watch?v=example2&#10;https://www.tiktok.com/@user/video/example3&#10;..."></textarea>
                </div>
                
                <button class="btn" onclick="downloadBulk()">
                    <span id="bulk-spinner" class="loading-spinner" style="display: none;"></span>
                    <span id="bulk-text">üì¶ Download All</span>
                </button>
                
                <div id="bulk-status"></div>
            </div>

            <!-- Downloads Tab -->
            <div id="downloads-tab" class="tab-content">
                <div class="section-title">
                    <span>üìÅ</span>
                    <span>My Downloads</span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="refreshDownloads()">
                        üîÑ Refresh
                    </button>
                    <button class="btn btn-danger" onclick="clearDownloads()" style="margin-left: 10px;">
                        üóëÔ∏è Clear All
                    </button>
                </div>
                
                <div id="downloads-list"></div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="download-section">
            <div class="section-title">
                <span>‚ú®</span>
                <span>Features</span>
            </div>
            
            <div class="feature-list">
                <div class="feature-item">
                    <h3>üéØ Auto Detection</h3>
                    <p>Automatically detects the platform and content type from any URL</p>
                </div>
                <div class="feature-item">
                    <h3>üì± All Content Types</h3>
                    <p>Posts, Stories, Reels, Videos, Photos, Playlists, and more</p>
                </div>
                <div class="feature-item">
                    <h3>üì¶ Bulk Downloads</h3>
                    <p>Download multiple URLs at once for maximum efficiency</p>
                </div>
                <div class="feature-item">
                    <h3>üîí Privacy First</h3>
                    <p>All downloads are processed locally on your server</p>
                </div>
                <div class="feature-item">
                    <h3>üìä High Quality</h3>
                    <p>Downloads the highest available quality for all content</p>
                </div>
                <div class="feature-item">
                    <h3>üìù Metadata</h3>
                    <p>Preserves titles, descriptions, and other important information</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to selected tab
            event.target.classList.add('active');
            
            // Load downloads if downloads tab is selected
            if (tabName === 'downloads') {
                refreshDownloads();
            }
        }

        // Single download functionality
        async function downloadSingle() {
            const url = document.getElementById('single-url').value.trim();
            const statusDiv = document.getElementById('single-status');
            const spinner = document.getElementById('single-spinner');
            const buttonText = document.getElementById('single-text');
            
            if (!url) {
                showStatus(statusDiv, 'Please enter a valid URL', 'error');
                return;
            }
            
            // Show loading state
            spinner.style.display = 'inline-block';
            buttonText.textContent = 'Downloading...';
            document.querySelector('#single-tab .btn').disabled = true;
            
            try {
                const response = await fetch('/download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showStatus(statusDiv, `‚úÖ ${result.message}`, 'success');
                    if (result.title) {
                        showStatus(statusDiv, `üìù Title: ${result.title}`, 'success', true);
                    }
                    if (result.platform) {
                        showStatus(statusDiv, `üåê Platform: ${result.platform}`, 'success', true);
                    }
                    document.getElementById('single-url').value = '';
                } else {
                    showStatus(statusDiv, `‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus(statusDiv, `‚ùå Network error: ${error.message}`, 'error');
            } finally {
                // Reset loading state
                spinner.style.display = 'none';
                buttonText.textContent = 'üöÄ Download Now';
                document.querySelector('#single-tab .btn').disabled = false;
            }
        }

        // Bulk download functionality
        async function downloadBulk() {
            const urlsText = document.getElementById('bulk-urls').value.trim();
            const statusDiv = document.getElementById('bulk-status');
            const spinner = document.getElementById('bulk-spinner');
            const buttonText = document.getElementById('bulk-text');
            
            if (!urlsText) {
                showStatus(statusDiv, 'Please enter at least one URL', 'error');
                return;
            }
            
            const urls = urlsText.split('\n').filter(url => url.trim());
            
            if (urls.length === 0) {
                showStatus(statusDiv, 'Please enter valid URLs', 'error');
                return;
            }
            
            // Show loading state
            spinner.style.display = 'inline-block';
            buttonText.textContent = `Processing ${urls.length} URLs...`;
            document.querySelector('#bulk-tab .btn').disabled = true;
            
            try {
                const response = await fetch('/bulk-download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ urls: urls })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showStatus(statusDiv, `‚úÖ ${result.message}`, 'success');
                    
                    // Show individual results
                    result.results.forEach((res, index) => {
                        const status = res.status === 'success' ? 'success' : 'error';
                        const icon = res.status === 'success' ? '‚úÖ' : '‚ùå';
                        showStatus(statusDiv, `${icon} URL ${index + 1}: ${res.message}`, status, true);
                    });
                    
                    document.getElementById('bulk-urls').value = '';
                } else {
                    showStatus(statusDiv, `‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus(statusDiv, `‚ùå Network error: ${error.message}`, 'error');
            } finally {
                // Reset loading state
                spinner.style.display = 'none';
                buttonText.textContent = 'üì¶ Download All';
                document.querySelector('#bulk-tab .btn').disabled = false;
            }
        }

        // Refresh downloads list
        async function refreshDownloads() {
            const downloadsDiv = document.getElementById('downloads-list');
            
            try {
                const response = await fetch('/downloads');
                const result = await response.json();
                
                if (result.items && result.items.length > 0) {
                    let html = '<div class="downloads-grid">';
                    
                    result.items.forEach(item => {
                        html += `
                            <div class="download-item">
                                <h3>${item.name}</h3>
                                <p>
                                    ${item.type === 'file' ? 
                                        `üìÑ File (${formatFileSize(item.size)})` : 
                                        `üìÅ Folder (${item.file_count} files)`
                                    }
                                </p>
                                <div class="download-actions">
                                    ${item.type === 'file' ? 
                                        `<button class="btn btn-small" onclick="downloadFile('${item.name}')">‚¨áÔ∏è Download</button>` :
                                        `<button class="btn btn-small" onclick="downloadFolder('${item.name}')">üì¶ Download ZIP</button>`
                                    }
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    downloadsDiv.innerHTML = html;
                } else {
                    downloadsDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; margin: 40px 0;">No downloads yet. Start downloading some content!</p>';
                }
            } catch (error) {
                downloadsDiv.innerHTML = `<p style="color: #e74c3c;">Error loading downloads: ${error.message}</p>`;
            }
        }

        // Download file
        function downloadFile(filename) {
            window.open(`/download-file/${encodeURIComponent(filename)}`, '_blank');
        }

        // Download folder as ZIP
        function downloadFolder(foldername) {
            window.open(`/download-folder/${encodeURIComponent(foldername)}`, '_blank');
        }

        // Clear all downloads
        async function clearDownloads() {
            if (!confirm('Are you sure you want to clear all downloads? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch('/clear-downloads', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('‚úÖ All downloads cleared successfully!');
                    refreshDownloads();
                } else {
                    alert(`‚ùå Error: ${result.message}`);
                }
            } catch (error) {
                alert(`‚ùå Network error: ${error.message}`);
            }
        }

        // Utility functions
        function showStatus(container, message, type, append = false) {
            const statusClass = `status-${type}`;
            const statusHtml = `<div class="${statusClass} status-message">${message}</div>`;
            
            if (append) {
                container.innerHTML += statusHtml;
            } else {
                container.innerHTML = statusHtml;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Event listeners
        document.getElementById('single-url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                downloadSingle();
            }
        });

        // Auto-detect and show platform info
        document.getElementById('single-url').addEventListener('input', function(e) {
            const url = e.target.value.toLowerCase();
            let platform = 'Unknown';
            
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                platform = 'YouTube';
            } else if (url.includes('instagram.com')) {
                platform = 'Instagram';
            } else if (url.includes('tiktok.com')) {
                platform = 'TikTok';
            } else if (url.includes('twitter.com') || url.includes('x.com')) {
                platform = 'Twitter/X';
            } else if (url.includes('facebook.com')) {
                platform = 'Facebook';
            } else if (url.includes('reddit.com')) {
                platform = 'Reddit';
            }
            
            if (platform !== 'Unknown' && url.trim()) {
                const statusDiv = document.getElementById('single-status');
                showStatus(statusDiv, `üåê Detected platform: ${platform}`, 'loading');
            }
        });

        // Load downloads on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up initial state
            console.log('Universal Social Media Downloader loaded! üöÄ');
        });
    </script>
</body>
</html>